{"version":3,"file":"push.js","sourceRoot":"","sources":["../../../../../src/cli/services/app/config/push.ts"],"names":[],"mappings":"AAAA,OAAO,EAAe,UAAU,EAAwC,MAAM,qCAAqC,CAAA;AACnH,OAAO,EAAoB,oBAAoB,EAAC,MAAM,gDAAgD,CAAA;AACtG,OAAO,EAAM,SAAS,EAAuB,MAAM,oCAAoC,CAAA;AACvF,OAAO,EAGL,kBAAkB,EAClB,wBAAwB,EACxB,iBAAiB,GAClB,MAAM,4BAA4B,CAAA;AACnC,OAAO,EAAuB,cAAc,EAAC,MAAM,0CAA0C,CAAA;AAC7F,OAAO,EAAC,kBAAkB,EAAC,MAAM,4BAA4B,CAAA;AAC7D,OAAO,EAAC,2BAA2B,EAAE,6BAA6B,EAAC,MAAM,kBAAkB,CAAA;AAC3F,OAAO,EAAC,cAAc,EAAC,MAAM,oBAAoB,CAAA;AACjD,OAAO,EAAC,oBAAoB,EAAC,MAAM,uCAAuC,CAAA;AAC1E,OAAO,EAAC,mBAAmB,EAAC,MAAM,kDAAkD,CAAA;AACpF,OAAO,EAAC,OAAO,EAAC,MAAM,+BAA+B,CAAA;AAErD,OAAO,EAAC,WAAW,EAAC,MAAM,0CAA0C,CAAA;AACpE,OAAO,EAAC,kBAAkB,EAAC,MAAM,gEAAgE,CAAA;AACjG,OAAO,EAAC,eAAe,EAAC,MAAM,oCAAoC,CAAA;AAClE,OAAO,EAAC,UAAU,EAAC,MAAM,6BAA6B,CAAA;AACtD,OAAO,EAAC,aAAa,EAAC,MAAM,0BAA0B,CAAA;AAEtD,OAAO,EAAC,QAAQ,EAAE,OAAO,EAAC,MAAM,4BAA4B,CAAA;AAE5D,OAAO,EAAC,GAAG,EAAC,MAAM,8BAA8B,CAAA;AAEhD,MAAM,mBAAmB,GAAG,GAAG,CAAC,MAAM,CAAC;IACrC,IAAI,EAAE,GAAG,CAAC,MAAM,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC;IAC1B,SAAS,EAAE,GAAG,CAAC,MAAM,EAAE;IACvB,eAAe,EAAE,WAAW,CAAC,GAAG,CAAC,MAAM,EAAE,CAAC;IAC1C,QAAQ,EAAE,GAAG,CAAC,OAAO,EAAE;IACvB,aAAa,EAAE,GAAG;SACf,MAAM,CAAC;QACN,MAAM,EAAE,GAAG,CAAC,MAAM,EAAE,CAAC,QAAQ,EAAE;QAC/B,uBAAuB,EAAE,GAAG,CAAC,OAAO,EAAE,CAAC,QAAQ,EAAE;KAClD,CAAC;SACD,QAAQ,EAAE;IACb,IAAI,EAAE,GAAG;SACN,MAAM,CAAC;QACN,aAAa,EAAE,GAAG,CAAC,KAAK,CAAC,WAAW,CAAC,GAAG,CAAC,MAAM,EAAE,CAAC,CAAC;KACpD,CAAC;SACD,QAAQ,EAAE;IACb,QAAQ,EAAE,GAAG,CAAC,MAAM,CAAC;QACnB,WAAW,EAAE,GAAG,CAAC,MAAM,EAAE;QACzB,kBAAkB,EAAE,GAAG;aACpB,MAAM,CAAC;YACN,qBAAqB,EAAE,kBAAkB,CAAC,QAAQ,EAAE;YACpD,yBAAyB,EAAE,kBAAkB,CAAC,QAAQ,EAAE;YACxD,iBAAiB,EAAE,kBAAkB,CAAC,QAAQ,EAAE;SACjD,CAAC;aACD,QAAQ,EAAE;KACd,CAAC;IACF,SAAS,EAAE,GAAG;SACX,MAAM,CAAC;QACN,GAAG,EAAE,WAAW,CAAC,GAAG,CAAC,MAAM,EAAE,CAAC;QAC9B,OAAO,EAAE,GAAG,CAAC,MAAM,EAAE;QACrB,MAAM,EAAE,GAAG,CAAC,MAAM,EAAE;KACrB,CAAC;SACD,QAAQ,EAAE;IACb,GAAG,EAAE,GAAG;SACL,MAAM,CAAC;QACN,QAAQ,EAAE,GAAG,CAAC,OAAO,EAAE;KACxB,CAAC;SACD,QAAQ,EAAE;IACb,eAAe,EAAE,GAAG;SACjB,MAAM,CAAC;QACN,GAAG,EAAE,WAAW,CAAC,GAAG,CAAC,MAAM,EAAE,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;KACxC,CAAC;SACD,QAAQ,EAAE;IACb,KAAK,EAAE,GAAG;SACP,MAAM,CAAC;QACN,gCAAgC,EAAE,GAAG,CAAC,OAAO,EAAE,CAAC,QAAQ,EAAE;QAC1D,aAAa,EAAE,GAAG,CAAC,MAAM,EAAE,CAAC,QAAQ,EAAE;KACvC,CAAC;SACD,QAAQ,EAAE;IACb,qBAAqB,EAAE,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,EAAE,CAAC,CAAC,QAAQ,EAAE;IACzD,eAAe,EAAE,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,EAAE,CAAC,CAAC,QAAQ,EAAE;CACpD,CAAC,CAAA;AAEF,MAAM,CAAC,MAAM,qBAAqB,GAChC,kHAAkH;IAClH,iHAAiH;IACjH,wDAAwD;IACxD,oFAAoF,CAAA;AAQtF,MAAM,WAAW,GAA4B;IAC3C,KAAK,EAAE,MAAM;IACb,OAAO,EAAE,WAAW;IACpB,sBAAsB,EAAE,sBAAsB;IAC9C,uBAAuB,EAAE,wBAAwB;IACjD,mBAAmB,EAAE,wBAAwB;IAC7C,aAAa,EAAE,6BAA6B;IAC5C,qCAAqC,EAAE,qDAAqD;IAC5F,yCAAyC,EAAE,yDAAyD;IACpG,iCAAiC,EAAE,iDAAiD;IACpF,cAAc,EAAE,qBAAqB;IACrC,qBAAqB,EAAE,oBAAoB;IAC3C,SAAS,EAAE,iBAAiB;IAC5B,eAAe,EAAE,uBAAuB;CACzC,CAAA;AAED,MAAM,UAAU,uBAAuB,CAAC,aAA+C;IACrF,MAAM,KAAK,GAAG,aAAa,IAAI,EAAE,CAAA;IACjC,MAAM,2BAA2B,GAAG,CAAC,KAAK,CAAC,QAAQ,CAAC,sBAAsB,CAAC,CAAA;IAC3E,OAAO,2BAA2B,CAAA;AACpC,CAAC;AAED,MAAM,CAAC,KAAK,UAAU,UAAU,CAAC,OAAoB;IACnD,IAAI,CAAC,kBAAkB,CAAC,OAAO,CAAC,aAAa,CAAC;QAAE,OAAM;IAEtD,oCAAoC;IACpC,MAAM,eAAe,GAAG,MAAM,oBAAoB,EAAE,CAAA;IACpD,MAAM,KAAK,GAAG,eAAe,CAAC,KAAK,CAAA;IACnC,MAAM,cAAc,GAAG,kBAAkB,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,OAAO,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,SAAS,CAAA;IACnH,MAAM,cAAc,GAAG,MAAM,mBAAmB,CAAC;QAC/C,KAAK;QACL,MAAM,EAAE,OAAO,CAAC,aAAa,CAAC,SAAS;QACvC,MAAM,EAAE,OAAO,CAAC,aAAa;KAC9B,CAAC,CAAA;IACF,MAAM,QAAQ,GAAG,MAAM,OAAO,CAAC;QAC7B,SAAS,EAAE,OAAO,CAAC,OAAO,CAAC,aAAa,CAAC,IAAI,CAAC;QAC9C,cAAc;QACd,UAAU,EAAE,cAAc;KAC3B,CAAC,CAAA;IACF,MAAM,aAAa,GAAG,QAAQ,CAAC,aAAwC,CAAA;IAEvE,6BAA6B;IAC7B,MAAM,cAAc,GAAG,EAAC,MAAM,EAAE,aAAa,CAAC,SAAS,EAAC,CAAA;IACxD,MAAM,WAAW,GAAyB,MAAM,eAAe,CAAC,SAAS,EAAE,KAAK,EAAE,cAAc,CAAC,CAAA;IACjG,IAAI,CAAC,WAAW,CAAC,GAAG;QAAE,KAAK,CAAC,0DAA0D,CAAC,CAAA;IACvF,MAAM,EAAC,GAAG,EAAC,GAAG,WAAW,CAAA;IACzB,MAAM,qBAAqB,GAAG,uBAAuB,CAAC,GAAG,CAAC,aAAa,CAAC,CAAA;IACxE,IAAI,qBAAqB;QAAE,KAAK,CAAC,qBAAqB,CAAC,CAAA;IAEvD,MAAM,EAAC,YAAY,EAAE,GAAG,EAAC,GAAG,MAAM,cAAc,CAAC,GAAG,CAAC,cAAc,EAAE,eAAe,CAAC,CAAA;IACrF,6BAA6B,CAAC,EAAC,GAAG,EAAE,OAAO,EAAE,GAAG,CAAC,KAAK,EAAE,UAAU,EAAE,cAAc,EAAC,CAAC,CAAA;IAEpF,MAAM,2BAA2B,CAAC,GAAG,CAAC,CAAA;IAEtC,IAAI,CAAC,CAAC,MAAM,kBAAkB,CAAC,OAAO,CAAC,KAAK,EAAE,aAAa,EAAE,GAAG,EAAE,mBAAmB,CAAC,CAAC;QAAE,OAAM;IAE/F,MAAM,SAAS,GAAG,eAAe,CAAC,GAAG,EAAE,aAAa,CAAC,CAAA;IAErD,MAAM,MAAM,GAAqB,MAAM,eAAe,CAAC,UAAU,EAAE,KAAK,EAAE,SAAS,CAAC,CAAA;IAEpF,IAAI,MAAM,CAAC,SAAS,CAAC,UAAU,CAAC,MAAM,GAAG,CAAC,EAAE;QAC1C,MAAM,MAAM,GAAG,MAAM,CAAC,SAAS,CAAC,UAAU;aACvC,GAAG,CAAC,CAAC,KAAK,EAAE,EAAE;YACb,MAAM,CAAC,CAAC,EAAE,GAAG,SAAS,CAAC,GAAG,KAAK,CAAC,KAAK,IAAI,EAAE,CAAA;YAC3C,MAAM,UAAU,GAAG,WAAW,CAAC,SAAS,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,IAAI,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;YAC3E,MAAM,SAAS,GAAG,UAAU,CAAC,CAAC,CAAC,GAAG,UAAU,IAAI,CAAC,CAAC,CAAC,EAAE,CAAA;YACrD,OAAO,GAAG,SAAS,GAAG,KAAK,CAAC,OAAO,EAAE,CAAA;QACvC,CAAC,CAAC;aACD,IAAI,CAAC,IAAI,CAAC,CAAA;QACb,KAAK,CAAC,MAAM,CAAC,CAAA;KACd;IAED,MAAM,kBAAkB,GACtB,GAAG,CAAC,qBAAqB;QACzB,CAAC,SAAS,CAAC,qBAAqB,KAAK,SAAS,IAAI,wBAAwB,CAAC,aAAa,CAAC,CAAC,CAAA;IAE5F,IAAI,kBAAkB,EAAE;QACtB,MAAM,WAAW,GAAsB,MAAM,eAAe,CAAC,oBAAoB,EAAE,KAAK,EAAE,EAAC,MAAM,EAAE,GAAG,CAAC,MAAM,EAAC,CAAC,CAAA;QAE/G,IAAI,WAAW,CAAC,6BAA6B,EAAE,UAAU,EAAE,MAAM,GAAG,CAAC,EAAE;YACrE,MAAM,MAAM,GAAG,WAAW,CAAC,6BAA6B,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC,KAAK,EAAE,EAAE,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;YAC5G,KAAK,CAAC,MAAM,CAAC,CAAA;SACd;KACF;IAED,IAAI,CAAC,aAAa,CAAC,SAAS,IAAI,GAAG,CAAC,QAAQ,EAAE;QAC5C,MAAM,YAAY,GAAyB,MAAM,eAAe,CAAC,cAAc,EAAE,KAAK,EAAE,EAAC,MAAM,EAAE,GAAG,CAAC,MAAM,EAAC,CAAC,CAAA;QAE7G,IAAI,YAAY,EAAE,UAAU,EAAE,MAAM,GAAG,CAAC,EAAE;YACxC,MAAM,MAAM,GAAG,YAAY,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC,KAAK,EAAE,EAAE,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;YAC/E,KAAK,CAAC,MAAM,CAAC,CAAA;SACd;KACF;IAED,aAAa,CAAC;QACZ,QAAQ,EAAE,+BAA+B,SAAS,CAAC,KAAK,EAAE;QAC1D,IAAI,EAAE,CAAC,QAAQ,cAAc,qCAAqC,CAAC;KACpE,CAAC,CAAA;AACJ,CAAC;AAED,MAAM,eAAe,GAAG,CAAC,GAAQ,EAAE,aAAsC,EAAE,EAAE;IAC3E,MAAM,SAAS,GAAwB;QACrC,MAAM,EAAE,aAAa,CAAC,SAAS;QAC/B,KAAK,EAAE,aAAa,CAAC,IAAI;QACzB,cAAc,EAAE,aAAa,CAAC,eAAe;QAC7C,iBAAiB,EAAE,aAAa,CAAC,QAAQ,EAAE,WAAW,IAAI,GAAG,CAAC,iBAAiB;QAC/E,oBAAoB,EAAE,aAAa,CAAC,IAAI,EAAE,aAAa,IAAI,IAAI;QAC/D,QAAQ,EAAE,aAAa,CAAC,QAAQ,IAAI,GAAG,CAAC,QAAQ;QAChD,YAAY,EAAE,kCAAkC,CAAC,aAAa,CAAC,QAAQ,EAAE,kBAAkB,CAAC;QAC5F,WAAW,EAAE,aAAa,CAAC,GAAG,EAAE,QAAQ,IAAI,KAAK;QACjD,cAAc,EAAE,aAAa,CAAC,eAAe,EAAE,GAAG,IAAI,IAAI;KAC3D,CAAA;IAED,IAAI,CAAC,wBAAwB,CAAC,aAAa,CAAC,IAAI,aAAa,CAAC,aAAa,EAAE,MAAM,KAAK,SAAS,EAAE;QACjG,SAAS,CAAC,qBAAqB,GAAG,iBAAiB,CAAC,aAAa,CAAC,CAAA;KACnE;IAED,IAAI,aAAa,CAAC,SAAS,EAAE;QAC3B,SAAS,CAAC,QAAQ,GAAG;YACnB,YAAY,EAAE,aAAa,CAAC,SAAS,CAAC,OAAO;YAC7C,kBAAkB,EAAE,aAAa,CAAC,SAAS,CAAC,MAAM;YAClD,QAAQ,EAAE,aAAa,CAAC,SAAS,CAAC,GAAG;SACtC,CAAA;KACF;IAED,OAAO,SAAS,CAAA;AAClB,CAAC,CAAA;AAED,MAAM,CAAC,MAAM,KAAK,GAAG,CAAC,YAA2B,EAAE,EAAE;IACnD,MAAM,IAAI,UAAU,CAAC,YAAY,CAAC,CAAA;AACpC,CAAC,CAAA;AAED,SAAS,kCAAkC,CAAC,iBAAuD;IACjG,OAAO;QACL,mBAAmB,EAAE,iBAAiB,EAAE,qBAAqB;QAC7D,sBAAsB,EAAE,iBAAiB,EAAE,yBAAyB;QACpE,eAAe,EAAE,iBAAiB,EAAE,iBAAiB;KACtD,CAAA;AACH,CAAC","sourcesContent":["import {GdprWebhooks, PushConfig, PushConfigSchema, PushConfigVariables} from '../../../api/graphql/push_config.js'\nimport {ClearScopesSchema, clearRequestedScopes} from '../../../api/graphql/clear_requested_scopes.js'\nimport {App, GetConfig, GetConfigQuerySchema} from '../../../api/graphql/get_config.js'\nimport {\n  AppConfiguration,\n  CurrentAppConfiguration,\n  isCurrentAppSchema,\n  usesLegacyScopesBehavior,\n  getAppScopesArray,\n} from '../../../models/app/app.js'\nimport {DeleteAppProxySchema, deleteAppProxy} from '../../../api/graphql/app_proxy_delete.js'\nimport {confirmPushChanges} from '../../../prompts/config.js'\nimport {logMetadataForLoadedContext, renderCurrentlyUsedConfigInfo} from '../../context.js'\nimport {fetchOrgFromId} from '../../dev/fetch.js'\nimport {fetchPartnersSession} from '../../context/partner-account-info.js'\nimport {fetchSpecifications} from '../../generate/fetch-extension-specifications.js'\nimport {loadApp} from '../../../models/app/loader.js'\nimport {WebhooksConfig} from '../../../models/extensions/specifications/types/app_config_webhook.js'\nimport {validateUrl} from '../../../models/app/validation/common.js'\nimport {ensureHttpsOnlyUrl} from '../../../models/extensions/specifications/validation/common.js'\nimport {partnersRequest} from '@shopify/cli-kit/node/api/partners'\nimport {AbortError} from '@shopify/cli-kit/node/error'\nimport {renderSuccess} from '@shopify/cli-kit/node/ui'\nimport {OutputMessage} from '@shopify/cli-kit/node/output'\nimport {basename, dirname} from '@shopify/cli-kit/node/path'\nimport {Config} from '@oclif/core'\nimport {zod} from '@shopify/cli-kit/node/schema'\n\nconst LegacyPushAppSchema = zod.object({\n  name: zod.string().max(30),\n  client_id: zod.string(),\n  application_url: validateUrl(zod.string()),\n  embedded: zod.boolean(),\n  access_scopes: zod\n    .object({\n      scopes: zod.string().optional(),\n      use_legacy_install_flow: zod.boolean().optional(),\n    })\n    .optional(),\n  auth: zod\n    .object({\n      redirect_urls: zod.array(validateUrl(zod.string())),\n    })\n    .optional(),\n  webhooks: zod.object({\n    api_version: zod.string(),\n    privacy_compliance: zod\n      .object({\n        customer_deletion_url: ensureHttpsOnlyUrl.optional(),\n        customer_data_request_url: ensureHttpsOnlyUrl.optional(),\n        shop_deletion_url: ensureHttpsOnlyUrl.optional(),\n      })\n      .optional(),\n  }),\n  app_proxy: zod\n    .object({\n      url: validateUrl(zod.string()),\n      subpath: zod.string(),\n      prefix: zod.string(),\n    })\n    .optional(),\n  pos: zod\n    .object({\n      embedded: zod.boolean(),\n    })\n    .optional(),\n  app_preferences: zod\n    .object({\n      url: validateUrl(zod.string().max(255)),\n    })\n    .optional(),\n  build: zod\n    .object({\n      automatically_update_urls_on_dev: zod.boolean().optional(),\n      dev_store_url: zod.string().optional(),\n    })\n    .optional(),\n  extension_directories: zod.array(zod.string()).optional(),\n  web_directories: zod.array(zod.string()).optional(),\n})\n\nexport const DeprecatedPushMessage =\n  'Command no longer supported.\\n\\nTo update your app configuration, upgrade Shopify CLI to the latest version and ' +\n  'run the `app deploy` command. It will update all extensions and also app configuration, if you opt-in for your ' +\n  'app. Review the documentation[1] for more details.\\n\\n' +\n  '[1] https://shopify.dev/docs/apps/tools/cli/configuration#migrate-from-config-push'\n\nexport interface PushOptions {\n  configuration: AppConfiguration\n  force: boolean\n  commandConfig: Config\n}\n\nconst FIELD_NAMES: {[key: string]: string} = {\n  title: 'name',\n  api_key: 'client_id',\n  redirect_url_whitelist: 'auth > redirect_urls',\n  requested_access_scopes: 'access_scopes > scopes',\n  webhook_api_version: 'webhooks > api_version',\n  gdpr_webhooks: 'webhooks.privacy_compliance',\n  'gdpr_webhooks,customer_deletion_url': 'webhooks.privacy_compliance > customer_deletion_url',\n  'gdpr_webhooks,customer_data_request_url': 'webhooks.privacy_compliance > customer_data_request_url',\n  'gdpr_webhooks,shop_deletion_url': 'webhooks.privacy_compliance > shop_deletion_url',\n  proxy_sub_path: 'app_proxy > subpath',\n  proxy_sub_path_prefix: 'app_proxy > prefix',\n  proxy_url: 'app_proxy > url',\n  preferences_url: 'app_preferences > url',\n}\n\nexport function isPushCommandDeprecated(disabledBetas: App['disabledBetas'] | undefined) {\n  const betas = disabledBetas ?? []\n  const versionedAppConfigIsEnabled = !betas.includes('versioned_app_config')\n  return versionedAppConfigIsEnabled\n}\n\nexport async function pushConfig(options: PushOptions) {\n  if (!isCurrentAppSchema(options.configuration)) return\n\n  // Load local complete configuration\n  const partnersSession = await fetchPartnersSession()\n  const token = partnersSession.token\n  const configFileName = isCurrentAppSchema(options.configuration) ? basename(options.configuration.path) : undefined\n  const specifications = await fetchSpecifications({\n    token,\n    apiKey: options.configuration.client_id,\n    config: options.commandConfig,\n  })\n  const localApp = await loadApp({\n    directory: dirname(options.configuration.path),\n    specifications,\n    configName: configFileName,\n  })\n  const configuration = localApp.configuration as CurrentAppConfiguration\n\n  // Fetch remote configuration\n  const queryVariables = {apiKey: configuration.client_id}\n  const queryResult: GetConfigQuerySchema = await partnersRequest(GetConfig, token, queryVariables)\n  if (!queryResult.app) abort(\"Couldn't find app. Make sure you have a valid client ID.\")\n  const {app} = queryResult\n  const pushCommandDeprecated = isPushCommandDeprecated(app.disabledBetas)\n  if (pushCommandDeprecated) abort(DeprecatedPushMessage)\n\n  const {businessName: org} = await fetchOrgFromId(app.organizationId, partnersSession)\n  renderCurrentlyUsedConfigInfo({org, appName: app.title, configFile: configFileName})\n\n  await logMetadataForLoadedContext(app)\n\n  if (!(await confirmPushChanges(options.force, configuration, app, LegacyPushAppSchema))) return\n\n  const variables = getMutationVars(app, configuration)\n\n  const result: PushConfigSchema = await partnersRequest(PushConfig, token, variables)\n\n  if (result.appUpdate.userErrors.length > 0) {\n    const errors = result.appUpdate.userErrors\n      .map((error) => {\n        const [_, ...fieldPath] = error.field || []\n        const mappedName = FIELD_NAMES[fieldPath.join(',')] || fieldPath.join(', ')\n        const fieldName = mappedName ? `${mappedName}: ` : ''\n        return `${fieldName}${error.message}`\n      })\n      .join('\\n')\n    abort(errors)\n  }\n\n  const shouldDeleteScopes =\n    app.requestedAccessScopes &&\n    (variables.requestedAccessScopes === undefined || usesLegacyScopesBehavior(configuration))\n\n  if (shouldDeleteScopes) {\n    const clearResult: ClearScopesSchema = await partnersRequest(clearRequestedScopes, token, {apiKey: app.apiKey})\n\n    if (clearResult.appRequestedAccessScopesClear?.userErrors?.length > 0) {\n      const errors = clearResult.appRequestedAccessScopesClear.userErrors.map((error) => error.message).join(', ')\n      abort(errors)\n    }\n  }\n\n  if (!configuration.app_proxy && app.appProxy) {\n    const deleteResult: DeleteAppProxySchema = await partnersRequest(deleteAppProxy, token, {apiKey: app.apiKey})\n\n    if (deleteResult?.userErrors?.length > 0) {\n      const errors = deleteResult.userErrors.map((error) => error.message).join(', ')\n      abort(errors)\n    }\n  }\n\n  renderSuccess({\n    headline: `Updated your app config for ${variables.title}`,\n    body: [`Your ${configFileName} config is live for your app users.`],\n  })\n}\n\nconst getMutationVars = (app: App, configuration: CurrentAppConfiguration) => {\n  const variables: PushConfigVariables = {\n    apiKey: configuration.client_id,\n    title: configuration.name,\n    applicationUrl: configuration.application_url,\n    webhookApiVersion: configuration.webhooks?.api_version ?? app.webhookApiVersion,\n    redirectUrlAllowlist: configuration.auth?.redirect_urls ?? null,\n    embedded: configuration.embedded ?? app.embedded,\n    gdprWebhooks: mapPrivacyComplianceToGdprWebhooks(configuration.webhooks?.privacy_compliance),\n    posEmbedded: configuration.pos?.embedded ?? false,\n    preferencesUrl: configuration.app_preferences?.url ?? null,\n  }\n\n  if (!usesLegacyScopesBehavior(configuration) && configuration.access_scopes?.scopes !== undefined) {\n    variables.requestedAccessScopes = getAppScopesArray(configuration)\n  }\n\n  if (configuration.app_proxy) {\n    variables.appProxy = {\n      proxySubPath: configuration.app_proxy.subpath,\n      proxySubPathPrefix: configuration.app_proxy.prefix,\n      proxyUrl: configuration.app_proxy.url,\n    }\n  }\n\n  return variables\n}\n\nexport const abort = (errorMessage: OutputMessage) => {\n  throw new AbortError(errorMessage)\n}\n\nfunction mapPrivacyComplianceToGdprWebhooks(privacyCompliance: WebhooksConfig['privacy_compliance']): GdprWebhooks {\n  return {\n    customerDeletionUrl: privacyCompliance?.customer_deletion_url,\n    customerDataRequestUrl: privacyCompliance?.customer_data_request_url,\n    shopDeletionUrl: privacyCompliance?.shop_deletion_url,\n  }\n}\n"]}